(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a8f2c78"],{"96f2":function(t,e,s){"use strict";s.d(e,"e",(function(){return n})),s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return c})),s.d(e,"d",(function(){return r})),s.d(e,"b",(function(){return a}));var o=s("1bab");function n(){return Object(o["a"])({method:"get",url:"/rooms"})}function i(t,e){return Object(o["a"])({method:"post",url:"/".concat(t),data:e})}function c(t){return Object(o["a"])({method:"get",url:"/enterpublic",params:{roomId:t}})}function r(t,e){return Object(o["a"])({method:"post",url:"/enterprivate",data:{roomId:t,password:e}})}function a(t){return Object(o["a"])({method:"get",url:"/deleteRoom",params:{roomId:t}})}},b737:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"watch_page"},[s("video",{attrs:{width:"100%",controls:"",id:"video"}},[s("source",{ref:"video"})]),s("div",{staticClass:"operate"},[s("span",{staticClass:"operate_box",on:{click:t.goHome}},[t._v("退出房间")]),s("span",{staticClass:"operate_box",on:{click:function(e){return t.delRoom(t.room.roomId)}}},[t._v("解散房间")])]),s("div",{attrs:{id:"welcome"}},[t._v("来和大家聊聊~")]),s("div",{staticClass:"chat_box"},[s("div",{staticClass:"chat_msg"},t._l(t.chat_msg,(function(e,o){return s("div",{key:o,staticClass:"item.text"},[s("div",{staticClass:"item_name"},[t._v(t._s(e.name))]),s("div",{staticClass:"item_text"},[t._v(t._s(e.text))])])})),0),s("div",{staticClass:"chat_my"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.my_ipt,expression:"my_ipt"}],staticClass:"my_text",attrs:{type:"text"},domProps:{value:t.my_ipt},on:{input:function(e){e.target.composing||(t.my_ipt=e.target.value)}}}),s("input",{staticClass:"my_sub",attrs:{type:"submit",value:"发送"},on:{click:t.subMsg}})])])])},n=[],i=s("96f2"),c={data:function(){return{isConnect:!1,room:{},my_ipt:"",chat_msg:[]}},mounted:function(){this.room=this.$route.params.room,this.$refs.video.src=this.room.movie.src,this.initWebsocket()},methods:{delRoom:function(t){var e=this;Object(i["b"])(t).then((function(t){if(!t.data.success)return alert(t.data.Msg);e.websocket.send(JSON.stringify({msg:"房间已被".concat(e.$store.state.user.userName,"解散，即将返回首页!")}))}))},goHome:function(){this.isConnect=!1,this.websocket.close(),this.$router.push("/user")},subMsg:function(){return this.$store.state.user.userName?this.my_ipt?(this.websocket.send(JSON.stringify({text:this.my_ipt,name:this.$store.state.user.userName})),void(this.my_ipt="")):alert("发送内容不能为空哟~"):alert("请先登录！")},initWebsocket:function(){var t=this,e="wss://47.97.214.211/chat/".concat(this.room.roomId);"WebSocket"in window&&!this.isConnect?(this.websocket=new WebSocket(e),this.isConnect=!0):alert(" Not support websocket"),this.websocket.onmessage=function(e){var s=JSON.parse(e.data);if(!s.msg)return t.chat_msg.push(s);alert(s.msg),t.isConnect=!1,t.websocket.close(),t.$router.push("/user")},this.websocket.onclose=function(){console.log("WebSocket连接关闭")},this.websocket.onerror=function(){this.connect&&(this.websocket=new WebSocket(e))},window.onbeforeunload=function(){this.websocket.close()},this.$router.beforeEach((function(e,s,o){t.websocket.close(),o()}))}}},r=c,a=(s("d239"),s("2877")),u=Object(a["a"])(r,o,n,!1,null,"17cae8f6",null);e["default"]=u.exports},d239:function(t,e,s){"use strict";var o=s("eca5"),n=s.n(o);n.a},eca5:function(t,e,s){}}]);
//# sourceMappingURL=chunk-7a8f2c78.54327cfa.js.map